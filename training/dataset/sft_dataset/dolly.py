from .sftdataset import SFTDataset


class DollyDataset(SFTDataset):
    """
    Databricks' `databricks-dolly-15k` dataset is generated by Databricks employees in capability domains from the InstructGPT paper,
    including brainstorming, classification, closed QA, generation, information extraction, open QA and summarization.
    """
    
    def process(self,tokenizer):
        """Process the dataset and return input_ids and labels."""
        input_ids = []
        labels = []
        list_data_dict = self.load_data()
        for example in list_data_dict:
            s = tokenizer.apply_chat_template([{'role':'user','content':example['instruction']+example['context']}],tokenize=False)
            t = tokenizer.apply_chat_template([{'role':'assistant','content':example['response']}],tokenize=False)
            input_id, label = self.encode_src_tgt(s, t, tokenizer)
            input_ids.append(input_id)
            labels.append(label)
        return input_ids, labels
    
